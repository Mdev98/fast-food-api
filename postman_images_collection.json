{
  "info": {
    "_postman_id": "fast-food-images-2025",
    "name": "Fast-Food API - Gestion Images",
    "description": "Collection complète pour tester l'upload et la gestion des images de produits avec Cloudinary",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:5001",
      "type": "string"
    },
    {
      "key": "api_key",
      "value": "your_secret_key_here",
      "type": "string"
    },
    {
      "key": "uploaded_image_url",
      "value": "",
      "type": "string"
    },
    {
      "key": "public_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "product_id",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Images",
      "item": [
        {
          "name": "1. Upload Image",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Tests automatiques",
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Image uploadée avec succès\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.eql(\"Image uploadée avec succès\");",
                  "    pm.expect(jsonData.image_url).to.include('cloudinary.com');",
                  "});",
                  "",
                  "// Sauvegarder les variables pour les tests suivants",
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('uploaded_image_url', jsonData.image_url);",
                  "    pm.collectionVariables.set('public_id', jsonData.public_id);",
                  "    console.log('✅ Image URL saved:', jsonData.image_url);",
                  "    console.log('✅ Public ID saved:', jsonData.public_id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "X-API-KEY",
                "value": "{{api_key}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "image",
                  "type": "file",
                  "src": []
                },
                {
                  "key": "product_name",
                  "value": "Pizza Margherita Test",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{base_url}}/products/upload-image",
              "host": ["{{base_url}}"],
              "path": ["products", "upload-image"]
            },
            "description": "Upload une image de produit vers Cloudinary.\n\n**Important:** Sélectionnez \"File\" pour le champ image et choisissez un fichier image (PNG, JPG, JPEG, GIF, WEBP, max 5MB)."
          },
          "response": []
        },
        {
          "name": "2. Delete Image by URL",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200 or 404\", function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    pm.test(\"Image supprimée avec succès\", function () {",
                  "        var jsonData = pm.response.json();",
                  "        pm.expect(jsonData.message).to.eql(\"Image supprimée avec succès\");",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "X-API-KEY",
                "value": "{{api_key}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"image_url\": \"{{uploaded_image_url}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/products/delete-image",
              "host": ["{{base_url}}"],
              "path": ["products", "delete-image"]
            },
            "description": "Supprime une image de Cloudinary en utilisant son URL complète."
          },
          "response": []
        },
        {
          "name": "3. Delete Image by Public ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200 or 404\", function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "X-API-KEY",
                "value": "{{api_key}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"public_id\": \"{{public_id}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/products/delete-image",
              "host": ["{{base_url}}"],
              "path": ["products", "delete-image"]
            },
            "description": "Supprime une image de Cloudinary en utilisant son Public ID."
          },
          "response": []
        }
      ],
      "description": "Endpoints pour la gestion des images avec Cloudinary"
    },
    {
      "name": "Produits avec Images",
      "item": [
        {
          "name": "1. Create Product with Image",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Produit créé avec succès\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.eql(\"Produit créé avec succès\");",
                  "    pm.expect(jsonData.product).to.have.property('id');",
                  "    pm.expect(jsonData.product).to.have.property('image_url');",
                  "});",
                  "",
                  "// Sauvegarder l'ID du produit",
                  "if (pm.response.code === 201) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('product_id', jsonData.product.id);",
                  "    console.log('✅ Product ID saved:', jsonData.product.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "X-API-KEY",
                "value": "{{api_key}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Pizza Margherita Test\",\n  \"description\": \"Pizza classique avec sauce tomate, mozzarella et basilic frais\",\n  \"price\": 9.50,\n  \"category\": \"Pizzas\",\n  \"brand\": \"mamapizza\",\n  \"image_url\": \"{{uploaded_image_url}}\",\n  \"available\": true\n}"
            },
            "url": {
              "raw": "{{base_url}}/products",
              "host": ["{{base_url}}"],
              "path": ["products"]
            },
            "description": "Crée un nouveau produit avec l'image uploadée précédemment.\n\n**Note:** Exécutez d'abord \"Upload Image\" pour avoir une image_url valide."
          },
          "response": []
        },
        {
          "name": "2. Get All Products",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response has products array\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('products');",
                  "    pm.expect(jsonData.products).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/products",
              "host": ["{{base_url}}"],
              "path": ["products"]
            },
            "description": "Récupère tous les produits, y compris leurs images."
          },
          "response": []
        },
        {
          "name": "3. Get Single Product",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Product has image_url\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.image_url) {",
                  "        pm.expect(jsonData.image_url).to.include('http');",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/products/{{product_id}}",
              "host": ["{{base_url}}"],
              "path": ["products", "{{product_id}}"]
            },
            "description": "Récupère les détails d'un produit spécifique avec son image."
          },
          "response": []
        },
        {
          "name": "4. Update Product Image",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Product updated successfully\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('succès');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "X-API-KEY",
                "value": "{{api_key}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"image_url\": \"{{uploaded_image_url}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/products/{{product_id}}",
              "host": ["{{base_url}}"],
              "path": ["products", "{{product_id}}"]
            },
            "description": "Met à jour l'image d'un produit existant."
          },
          "response": []
        },
        {
          "name": "5. Delete Product",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "X-API-KEY",
                "value": "{{api_key}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{base_url}}/products/{{product_id}}",
              "host": ["{{base_url}}"],
              "path": ["products", "{{product_id}}"]
            },
            "description": "Supprime un produit (mais pas son image sur Cloudinary).\n\n**Note:** Pour supprimer aussi l'image, utilisez d'abord \"Delete Image\" avant de supprimer le produit."
          },
          "response": []
        }
      ],
      "description": "Gestion complète des produits avec leurs images"
    },
    {
      "name": "Workflow Complet",
      "item": [
        {
          "name": "Step 1 - Upload Image",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "X-API-KEY",
                "value": "{{api_key}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "image",
                  "type": "file",
                  "src": []
                },
                {
                  "key": "product_name",
                  "value": "Nouveau Produit",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{base_url}}/products/upload-image",
              "host": ["{{base_url}}"],
              "path": ["products", "upload-image"]
            }
          },
          "response": []
        },
        {
          "name": "Step 2 - Create Product",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "X-API-KEY",
                "value": "{{api_key}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Nouveau Produit\",\n  \"description\": \"Description du produit\",\n  \"price\": 10.00,\n  \"category\": \"Catégorie\",\n  \"brand\": \"mamapizza\",\n  \"image_url\": \"{{uploaded_image_url}}\",\n  \"available\": true\n}"
            },
            "url": {
              "raw": "{{base_url}}/products",
              "host": ["{{base_url}}"],
              "path": ["products"]
            }
          },
          "response": []
        },
        {
          "name": "Step 3 - Verify Product",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/products/{{product_id}}",
              "host": ["{{base_url}}"],
              "path": ["products", "{{product_id}}"]
            }
          },
          "response": []
        },
        {
          "name": "Step 4 - Delete Image",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "X-API-KEY",
                "value": "{{api_key}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"image_url\": \"{{uploaded_image_url}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/products/delete-image",
              "host": ["{{base_url}}"],
              "path": ["products", "delete-image"]
            }
          },
          "response": []
        },
        {
          "name": "Step 5 - Delete Product",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "X-API-KEY",
                "value": "{{api_key}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{base_url}}/products/{{product_id}}",
              "host": ["{{base_url}}"],
              "path": ["products", "{{product_id}}"]
            }
          },
          "response": []
        }
      ],
      "description": "Workflow complet pour tester le cycle de vie d'un produit avec image"
    },
    {
      "name": "Health Check",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/health",
          "host": ["{{base_url}}"],
          "path": ["health"]
        },
        "description": "Vérifie que l'API est opérationnelle"
      },
      "response": []
    }
  ]
}
